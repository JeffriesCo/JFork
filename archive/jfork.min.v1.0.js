/*!
 * jfork JavaScript Framework v1.0
 * http://jfork.com/
 *
 * Copyright 2012 The Jeffries Company and other contributors
 * Released under the MIT license
 * https://github.com/JeffriesCo/JFork/blob/master/LICENSE
 */

(function(window,undefined){var is={Number:function(e){return(e||e==0)&&!isNaN(e)&&e.constructor==Number?true:false},Function:function(e){return e instanceof Function?true:false},NodeList:function(e){return e&&is["Number"](e.length)&&is["Function"](e.item)?true:false},Date:function(e){return e instanceof Date?true:false},Element:function(e){return e&&("undefined"!==typeof e.childNodes||e.nodeType)?true:false},Array:function(e){return e&&e.constructor==Array?true:false},Object:function(e){return e&&typeof e=="object"&&!is["Array"](e)&&!is["Element"](e)&&!is["Date"](e)&&!is["NodeList"](e)?true:false},String:function(e){return typeof e=="string"?true:false},Boolean:function(e){return typeof e=="boolean"?true:false},Null:function(e){return e===null?true:false},RegExp:function(e){return e instanceof RegExp?true:false},Undefined:function(e){return e===undefined?true:false},Integer:function(e){return is["Number"](e)&&(e+"").indexOf(".")==-1?true:false},Variant:function(e){return true}};var ie=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0]){}return t>4?t:e}();var addEvent=function(e,t,n){if(e.attachEvent){e["e"+t+n]=n;e[t+n]=function(){e["e"+t+n](window.event)};e.attachEvent("on"+t,e[t+n])}else{e.addEventListener(t,n,false)}};var parseJSON=function(e){if(!jfork.isString(e)){return null}var t=/^[\],:{}\s]*$/;var n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var i=/(?:^|:|,)(?:\s*\[)+/g;e=e.replace(/^\s+|\s+$/g,"");if(window.JSON&&window.JSON.parse){return window.JSON.parse(e)}else if(t.test(e.replace(n,"@").replace(r,"]").replace(i,""))){return(new Function("return "+e))()}else{throw new Error("Cannot Parse JSON String.")}};var listen=function(e,t,n,r){if(ie<8){if(!e.propertyChangeHandlers){e.propertyChangeHandlers={}}if(e.propertyChangeHandlers[t]){e.detachEvent("onpropertychange",e.propertyChangeHandlers[t])}var i=function(s){if(s.propertyName==t){e.detachEvent("onpropertychange",i);r(e[t]);e[t]=n;e[t].toString=n;e.attachEvent("onpropertychange",i)}};e[t]=n;e[t].toString=n;e.attachEvent("onpropertychange",i);e.propertyChangeHandlers[t]=i}else{Object.defineProperty(e,t,{get:n,set:r,configurable:true})}};var looper=function(e,t){if(is.Array(e)){for(var n=0;n<e.length;n++){t(n,e[n],e)}}else{for(var r in e){t(r,e[r],e)}}};var clone=function(e){var t={};for(var n in e){if(is.Object(e[n])){t[n]=clone(e[n])}else{t[n]=e[n]}}return t};var bind=function(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}};var getKeys=function(e){var t=[];for(var n in e){t.push(n)}return t};var Classes=[];var Class=function(e){var t,n,r={dynamic:{"public":{methods:{},variables:{}},"private":{methods:{},variables:{}}},"static":{"public":{methods:{},variables:{}},"private":{methods:{},variables:{}}}};var i=null;if(e.extend){for(var s=0;s<Classes.length;s++){if(e.extend===Classes[s].Class){i=Classes[s];r.dynamic=clone(i.signature.dynamic)}}if(i==null){throw new Error("Class to extend was not found.")}n=e.construct||i.construct}else{n=e.construct||function(){}}delete e.construct;delete e.extend;for(var o in e){var u=o.replace("private","").replace("public","").replace("static","").replace(/^\s+|\s+$/g,"");r[o.indexOf("static")!=-1?"static":"dynamic"][o.indexOf("private")!=-1?"private":"public"][e[o]instanceof Function?"methods":"variables"][u]=e[o]}var a=function(){if(ie<8){var e=document.createElement("class");document.body.appendChild(e);return e}else if(ie<9){var e=document.createElement("class");return e}else{return{}}};var f=function(e,t){for(var n in t.public.methods){e.public.methods[n]=t.public.methods[n]}for(var n in t.public.variables){e.public.variables[n]=t.public.variables[n]}for(var n in t.private.methods){e.private.methods[n]=t.private.methods[n]}for(var n in t.public.variables){e.private.variables[n]=t.private.variables[n]}return e};var l=function(e,t,n){n=n||t;looper(e,function(e,r,i){if(is.Function(r)){n[e]=bind(r,t)}else{listen(n,e,function(){return i[e]},function(t){i[e]=t})}})};var c=a();looper(r.static.public.variables,function(e,n){listen(c,e,function(){return t[e]},function(n){t[e]=n})});l(r.static.public.methods,c);l(r.static.private.variables,c);l(r.static.private.methods,c);t=function(){if(!(this instanceof t)){return null}var e=null,s=null,o=a(),u=clone(r.dynamic),f=arguments;if(i){function h(){return i.Class.apply(this,f)}h.prototype=i.Class.prototype;e=new h;s=i.instances[i.instances.length-1].privateDynamicContext;listen(s,"parent",ie<8?e:function(){return e},function(e){throw new Error("You cannot set super.")})}else{s=a()}looper(r.static.public.variables,function(e,n){listen(s,e,function(){return t[e]},function(n){t[e]=n})});l(r.static.public.methods,s);l(r.static.private.variables,s);l(r.static.private.methods,s);l(u.public.variables,s);l(u.public.methods,s);l(u.private.variables,s);l(u.private.methods,s);looper(r.static.public.variables,function(e,n){listen(o,e,function(){return t[e]},function(n){t[e]=n})});l(r.static.public.methods,c,o);l(u.public.variables,s,o);l(u.public.methods,s,o);o.dynamicSignature=u;o.signature=r;o.privateDynamicContext=s;for(var p=0;p<Classes.length;p++){if(t===Classes[p].Class){Classes[p].instances.push({instance:o,privateDynamicContext:s,dynamicSignature:u});break}}n.apply(s,f);return o};looper(r.static.public.variables,function(e,n){t[e]=n});l(r.static.public.methods,c,t);Classes.push({signature:r,construct:n,Class:t,privateStaticContext:c,instances:[]});return t};var jfork=Class;jfork.Class=Class;jfork.is=function(e){for(var t in is){if(is[t](e)){return t}}return null};for(var i in is){jfork.is[i]=is[i];jfork["is"+i]=is[i]}jfork.datatype=function(e){};jfork.Panel=jfork.Class({elem:null,isOpen:false,displayType:"block",events:{init:function(){},open:function(){},close:function(){}},construct:function(e,t){if(!jfork.isElement(e)){throw new Error("Element is required.")}this.elem=e;this.events={init:function(){},open:function(){},close:function(){},onCoverClick:function(){}};for(var n in this.events){if(t[n]&&this.events[n]){this.events[n]=t[n]}}if(t.isOpen){this.isOpen=true}if(t.appendTo){this.elem.parentNode.removeChild(this.elem);t.appendTo.appendChild(this.elem)}},initialize:function(){this.events.init.apply(this,arguments);if(this.isOpen){this.open()}},open:function(){this.elem.style.display=this.displayType;this.isOpen=true;this.events.open.apply(this,arguments)},close:function(){this.elem.style.display="none";this.isOpen=false;this.events.close.apply(this,arguments)}});jfork.Dialog=jfork.Class({extend:jfork.Panel,"static zIndex":1001,cover:null,events:{init:function(){},open:function(){},close:function(){},onCoverClick:function(){}},open:function(){var e=this;if(this.cover==null){this.cover=document.createElement("div");this.cover.id=this.elem.id+"_cover";this.cover.className="jfork_Dialog_cover";this.cover.style.position="fixed";this.cover.style.top="0px";this.cover.style.left="0px";this.cover.style.width="100%";this.cover.style.height="100%";this.cover.style.display="none";document.body.appendChild(this.cover);addEvent(this.cover,"click",function(){e.events.onCoverClick.apply(e,[])})}this.cover.style.zIndex=this.zIndex;this.cover.style.display="block";this.parent.open.apply(this.parent,arguments);this.zIndex=this.zIndex+1;this.elem.style.zIndex=this.zIndex;this.elem.style.top=Math.floor((window.innerHeight-this.elem.offsetHeight)/2)+"px";this.elem.style.left=Math.floor((window.innerWidth-this.elem.offsetWidth)/2)+"px"},close:function(){this.cover.style.display="none";this.parent.close()}});jfork.PanelFactory=jfork.Class({storage:{},"private isPageLoaded":false,construct:function(){this.storage={}},initialize:function(){this.isPageLoaded=true;for(var e in this.storage){if(document.getElementById(e)){this.storage[e].instance=this.create(e,this.storage[e].args);this.storage[e].instance.initialize()}else{delete this.storage[e]}}},toggle:function(e){if(this.storage[e]){if(this.storage[e].instance.isOpen){this.close(e)}else{this.open(e)}}},open:function(e,t){if(this.storage[e]){for(var n in this.storage){if(this.storage[n].group&&n!=e&&this.storage[n].group==this.storage[e].group){this.storage[n].instance.close()}}this.storage[e].instance.open.apply(this.storage[e].instance,t)}},close:function(e){if(this.storage[e]){this.storage[e].instance.close()}},get:function(e){if(this.storage[e]){return this.storage[e].instance}},add:function(e,t){var n=t.group||false;delete t.group;this.storage[e]={args:t,group:n};if(this.isPageLoaded){this.storage[e].instance=this.create(e,t)}},"private create":function(e,t){t=t||{};return new jfork.Panel(document.getElementById(e),t)}});jfork.DialogFactory=jfork.Class({extend:jfork.PanelFactory,"private create":function(e,t){t=t||{};return new jfork.Dialog(document.getElementById(e),t)}});jfork.AJAX=jfork.Class({"public static send":function(e){if(!e.url){return false}var t=e.method||"GET";var n=this.getRequest();n.abort();n.onreadystatechange=function(){if(n.readyState==4){if(n.status==200){if(e.onComplete){e.onComplete(n.responseText,n)}}else{if(e.onFail){e.onFail(n.responseText,n)}}}};var r=this.buildArgs(e.data||{});if(t=="POST"){n.open("POST",e.url,true);n.setRequestHeader("Content-type","application/x-www-form-urlencoded");n.send(r)}else{if(e.url.indexOf("?")==-1){e.url+="?"}if(e.url.indexOf("=")!=-1){e.url+="&"}n.open("GET",e.url+r,true);n.send("")}},"public static getRequest":function(){var e=false;if(window.XMLHttpRequest&&!window.ActiveXObject){try{e=new XMLHttpRequest}catch(t){e=null}}else if(window.ActiveXObject){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=null}}}return e},"private static buildArgs":function(e){var t="";for(var n in e){if(is.Array(e[n])){for(var r=0;r<e[n].length;r++){if(t.indexOf("=")!=-1){t+="&"}t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n][r])}}else{if(t.indexOf("=")!=-1){t+="&"}t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])}}return t}});jfork.API=jfork.Class({"private apiCalls":{},"private onComplete":function(){},construct:function(e,t){this.apiCalls=e;this.onComplete=t||function(){return true}},send:function(e,t){var n=this;t=t||{};var r=this.getPath(e,t.params);if(!r){return}t.data=t.data||{};t.method=t.method=="POST"?"POST":"GET";t.onSuccess=t.onSuccess||function(){};t.onFail=t.onFail||function(){};t.onComplete=t.onComplete||function(){};jfork.AJAX.send({url:r,method:t.method,data:t.data,onComplete:function(e){var r=parseJSON(e);if(r){var i=n.onComplete(r,t);if(i){t.onSuccess(r,t)}else{t.onFail(r,t)}t.onComplete(r,t)}else{t.onFail({message:"Unable to parse JSON."},t)}},onFail:function(e){t.onFail({message:e},t)}})},"private getPath":function(e,t){if(this.apiCalls[e]){var n=this.apiCalls[e];t=t||{};for(var r in t){n=n.replace("{"+r+"}",t[r])}if(n.indexOf("{")>-1||n.indexOf("}")>-1){return false}return n}else{return false}}});jfork.notification=new jfork.Class({"private onSet":null,"private onOpen":null,"private onClose":null,"private queue":null,"private elem":null,"private timeout":null,"private isOpen":false,"private delay":1e3,construct:function(e,t){t=t||{};this.queue=[];this.elem=e;this.delay=t.delay||1e3;this.onSet=t.set||false;this.onOpen=t.open||false;this.onClose=t.close||false},"private open":function(){if(this.isOpen){return}this.isOpen=true;if(this.onOpen){this.onOpen.apply(this,[this.elem])}else{this.elem.style.display="block"}},"private close":function(){if(!this.isOpen){return}this.isOpen=false;if(this.onClose){this.onClose.apply(this,[this.elem])}else{this.elem.style.display="none"}},"private set":function(e){if(this.onSet){this.onSet.apply(this,[this.elem,e])}else{this.elem.innerHTML=e}},"private next":function(){var e=this;this.timeout=null;if(this.queue.length>0){this.set(this.queue.pop());this.open();this.timeout=setTimeout(this.next,this.delay)}else{this.close()}},notify:function(e){this.queue.push(e);if(!this.timeout){this.next()}},clear:function(){this.close();clearTimeout(this.timeout)}});jfork.storage=new jfork.Class({"private primaryKey":null,"public static isAvailable":function(){try{if("localStorage"in window&&window["localStorage"]!==null){return true}}catch(e){return false}}(),construct:function(e){this.primaryKey=e},"public set":function(e,t){if(!this.isAvailable){return}var n=this.primaryKey+":"+e;if(jfork.isObject(t)){var r=function(e){var t=typeof e;if(t!="object"||e===null){e=String(e).replace(/"/g,"");if(t=="string"){e='"'+e+'"'}return e}else{var n,i,s=[],o=e&&e.constructor==Array;for(n in e){i=e[n];t=typeof i;if(t=="string")i='"'+i.replace(/"/g,"")+'"';else if(t=="object"&&i!==null)i=r(i);s.push((o?"":'"'+n+'":')+String(i))}return(o?"[":"{")+String(s)+(o?"]":"}")}};t=r(t)+":isObject"}window.localStorage.setItem(n,t);var i=window.localStorage.getItem(this.primaryKey+":allKeys")||"";i=i.split(",");for(var s=0;s<i.length;s++){if(i[s]==e){i.splice(s,1);break}}i.push(e);window.localStorage.setItem(this.primaryKey+":allKeys",i.join(","))},"public get":function(key){if(!this.isAvailable){return}var value=window.localStorage.getItem(this.primaryKey+":"+key);if(value){var valueSplit=value.split(":");if(valueSplit.pop()=="isObject"){value=eval("("+valueSplit.join(":")+")")}}return value},"public remove":function(e){if(!this.isAvailable){return}window.localStorage.removeItem(this.primaryKey+":"+e);var t=window.localStorage.getItem(this.primaryKey+":allKeys")||"";t=t.split(",");for(var n=0;n<t.length;n++){if(t[n]==e){t.splice(n,1);break}}window.localStorage.setItem(this.primaryKey+":allKeys",t.join(","))},"public getAll":function(){if(!this.isAvailable){return}var e=window.localStorage.getItem(this.primaryKey+":allKeys")||"";e=e.split(",");var t={};for(var n=0;n<e.length;n++){t[e[n]]=this.get(e[n])}return t},"public clear":function(){if(!this.isAvailable){return}var e=window.localStorage.getItem(this.primaryKey+":allKeys")||"";e=e.split(",");for(var t=0;t<e.length;t++){this.remove(e[t])}}});window.jfork=jfork})(window)