/*!
 * jfork JavaScript Framework v1.1
 * http://jfork.com/
 *
 * Copyright 2012 The Jeffries Company and other contributors
 * Released under the MIT license
 * https://github.com/JeffriesCo/JFork/blob/master/LICENSE
 */

window.jfork={};jfork.extend=function(e,t){if(t){for(var n in t){e[n]=t[n]}}return e};jfork.each=function(e,t){if(e.constructor==Array){for(var n=0,r=e.length;n<r;n++){if(t(n,e[n],e)===false){break}}}else{for(var n in e){if(t(n,e[n],e)===false){break}}}};jfork.bind=function(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}};jfork.addEvent=function(e,t,n){if(e.attachEvent){e["e"+t+n]=n;e[t+n]=function(){e["e"+t+n](window.event)};e.attachEvent("on"+t,e[t+n])}else{e.addEventListener(t,n,false)}};jfork.load=function(e){var t=false;var n=[];jfork.addEvent(window,"load",function(){jfork.each(n,function(e,t){t()});t=true});return function(e){t?e():n.push(e)}}();jfork.css=function(e,t){for(var n in t){e.style[n]=t[n]}};jfork.position=function(e){for(var t=0,n=0;e!=null;t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent);return{left:t,top:n}};jfork.height=function(e){return e.offsetHeight};jfork.width=function(e){return e.offsetWidth};jfork.dao=function(e){var t={data:true,put:true,parse:true,get:true,getAll:true};var n=function(n){n=n||{};for(var r in e.data){if(n[r]===undefined){n[r]=e.data[r]}}for(var r in e){if(e[r]instanceof Function&&!t[r]){n[r]=function(){return e[r].apply(n,Array.prototype.slice.call(arguments))}}}n.updateData=function(t){for(var r in e.data){if(t[r]!==null||t[r]!==undefined){n[r]=t[r]}}};n.put=function(){if(e.put){return e.put.apply(n,Array.prototype.slice.call(arguments))}return true};n.toString=function(){var t={};for(var r in e.data){t[r]=n[r]}return JSON.stringify(t)};return n};n.parse=function(t){if(e.parse){return n(e.parse.apply(n,Array.prototype.slice.call(arguments)))}else{return n(t)}};n.get=function(){if(e.get){return e.get.apply(n,Array.prototype.slice.call(arguments))}return null};n.getAll=function(){if(e.getAll){return e.getAll.apply(n,Array.prototype.slice.call(arguments))}return[]};return n};jfork.ajax=function(e){var t=jfork.ajax.request();t.onreadystatechange=function(){if(t.readyState==4){if(e.onComplete){e.onComplete(t.responseText,t)}if(t.status==200){if(e.onSuccess){e.onSuccess(t.responseText,t)}}else{if(e.onFail){e.onFail(t.responseText,t)}}}};var n=[];if(e.data){for(var r in e.data){if(e.data[r].constructor==Array){for(var i=0;i<e.data[r].length;i++){n.push(encodeURIComponent(r)+"="+encodeURIComponent(e.data[r][i]))}}else{n.push(encodeURIComponent(r)+"="+encodeURIComponent(e.data[r]))}}}var s=n.join("&");if(e.method&&e.method=="POST"){t.open("POST",e.url,true);t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.send(s)}else{if(e.url.indexOf("?")==-1){e.url+="?"}if(e.url.indexOf("=")!=-1){e.url+="&"}t.open("GET",e.url+s,true);t.send("")}return t};jfork.ajax.request=function(){var e=false;if(window.XMLHttpRequest&&!window.ActiveXObject){try{e=new XMLHttpRequest}catch(t){e=null}}else if(window.ActiveXObject){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=null}}}if(e){e.abort()}return e};jfork.api=function(e){e.onComplete=e.onComplete||function(e,t){return t.status==200?true:false};var t=function(t,n){if(e.urls[t]){var r=e.urls[t];n=n||{};for(var i in n){r=r.replace("{"+i+"}",n[i])}if(r.indexOf("{")>-1||r.indexOf("}")>-1){return false}return r}else{return false}};var n={};for(var r in e.urls){(function(r,i){n[r]=function(n){n=jfork.extend({params:"",data:{},method:"GET",onSuccess:function(){},onFail:function(){},onComplete:function(){}},n);var i=t(r,n.params);if(!i){return}for(var s in n.data){if(n.data[s]===null||n.data[s]===undefined){delete n.data[s]}}jfork.ajax({url:i,method:n.method,data:n.data,onComplete:function(t,r){var i;try{i=JSON.parse(t)}catch(s){i={}}if(e.onComplete(i,r,n)){n.onSuccess(i,r,n)}else{n.onFail(i,r,n)}n.onComplete(i,r,n)}})}})(r,e.urls[r])}return n};jfork.upload=function(e){e=jfork.extend({data:{},resize:null,multiple:false,retry:0,retryDelay:0,url:"",name:"file",type:"image/jpeg",parent:document.body,onAsyncInitialize:null,onBeforeLoad:function(){},onProgress:function(){},onRetry:function(){},onError:function(){},onLoad:function(){},onLoadWhen:function(e){return e.xhr.status==200}},e);var t=function(t){var n=atob(t.split(",")[1]);var r=[];for(var i=0;i<n.length;i++){r.push(n.charCodeAt(i))}return new Blob([new Uint8Array(r)],{type:e.type})};var n=document.createElement("form");n.setAttribute("enctype","multipart/form-data");n.setAttribute("method","post");n.setAttribute("action",e.url);e.parent.appendChild(n);var r=document.createElement("input");r.setAttribute("type","file");if(e.multiple){r.setAttribute("multiple","multiple")}n.appendChild(r);var i=function(n){var s=jfork.ajax.request();var o=r.files[n];var u=e.retry;var a=function(){e.onBeforeLoad({args:e,data:e.data,xhr:s,index:n,files:r.files});var t=new FormData;for(var i in e.data){t.append(i,e.data[i])}t.append(e.name,o);s.open("POST",e.url,true);s.setRequestHeader("X_FILENAME",r.files[n].name+n);s.send(t)};if(e.onProgress){s.upload.addEventListener("progress",function(t){e.onProgress({percent:t.loaded/t.total,index:n})},false)}s.onreadystatechange=function(t){if(s.readyState==4){var o=n==r.files.length-1?true:false;var f={args:e,data:e.data,xhr:s,response:s.responseText,index:n,files:r.files,isComplete:o};if(e.onLoadWhen(f)){e.onLoad(f);if(!o){i(n+1)}}else if(u-->0){e.onRetry(f);setTimeout(function(){a()},e.retryDelay)}else{e.onError(f);if(!o){i(n+1)}}}};if(e.resize&&window.Blob){var f=new Image;var l=new FileReader;f.onload=function(){var n=jfork.image(f);var r=n.resize({maxWidth:e.resize.width,maxHeight:e.resize.height,type:e.type});o=t(r);a()};l.onload=function(e){f.src=e.target.result};l.readAsDataURL(r.files[n])}else{a()}};r.addEventListener("change",function(){if(r.value==""){return}if(e.onAsyncInitialize){e.onAsyncInitialize(e,function(){i(0)})}else{i(0)}});return n};jfork.image=function(e){return{resize:function(t){var t=jfork.extend({maxWidth:0,maxHeight:0,type:"image/png",onLoad:null},t);var n=document.createElement("canvas");var r=n.getContext("2d");var i=e.width;var s=e.height;if(t.maxWidth/t.maxHeight<i/s){if(i>t.maxWidth){s*=t.maxWidth/i;i=t.maxWidth}}else{if(s>t.maxHeight){i*=t.maxHeight/s;s=t.maxHeight}}n.width=i;n.height=s;r.drawImage(e,0,0,i,s);var o=n.toDataURL(t.type,.95);document.body.appendChild(n);document.body.removeChild(n);if(t.onLoad){var u=new Image;u.onload=function(){t.onLoad(u)};u.src=o}return o},crop:function(){}}};jfork.group=function(){var e=[];var t=1e3;var n=function(e){e.style.top=Math.floor((window.innerHeight-e.offsetHeight)/2)+"px";e.style.left=Math.floor((window.innerWidth-e.offsetWidth)/2)+"px"};jfork.addEvent(window,"resize",function(){jfork.each(e,function(e,t){if(t.center){n(t.element)}})});return function(r){r=jfork.extend({element:null,parent:null,center:false,isFront:false,cover:false,coverClass:"",showCover:function(){if(r.cover){r.cover.style.display="block"}},hideCover:function(){if(r.cover){r.cover.style.display="none"}},mask:false,maskClass:"",showMask:function(){if(r.mask){r.mask.style.display="block"}},hideMask:function(){if(r.mask){r.mask.style.display="none"}},scroll:false,type:null,isVisible:false,display:"block",load:function(){},show:function(){},toggle:function(){},hide:function(){},bottom:function(){}},r);if(r.element==null){return null}for(var i in r){switch(i){case"load":jfork.load(function(){if(typeof r.element=="string"){r.element=document.getElementById(r.element)}if(r.element instanceof Element||r.element&&r.element.nodeType==1&&r.element.tagName!=undefined){e.push(r)}else{return}if(r.parent){if(typeof r.parent=="string"){r.parent=document.getElementById(r.parent)}if(r.parent instanceof Element||r.parent&&r.parent.nodeType==1&&r.parent.tagName!=undefined){if(r.element.offsetParent){r.element.offsetParent.removeChild(r.element)}r.parent.appendChild(r.element)}}if(r.mask){r.mask=document.createElement("div");jfork.css(r.mask,{position:"absolute",display:"none",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:t+1});r.mask.className=r.maskClass;r.element.appendChild(r.mask)}if(r.cover){r.cover=document.createElement("div");jfork.css(r.cover,{position:"absolute",display:"none",top:"0px",left:"0px",width:"100%",height:"100%"});r.cover.className=r.coverClass;r.element.parentNode.insertBefore(r.cover,r.element)}r.isVisible=r.element.style.display==r.display?true:false;r.load.apply(r,[])});break;case"show":var s=r.show;r.show=function(){if(r.isVisible){return}if(r.type){for(var i=0;i<e.length;i++){if(e[i].type==r.type){e[i].hide()}}}r.isVisible=true;r.element.style.display=r.display;if(r.isFront){r.element.style.zIndex=++t}if(r.center){n(r.element)}if(r.cover){if(r.isFront){r.cover.style.zIndex=t-1}r.showCover()}return s.apply(r,Array.prototype.slice.call(arguments))};break;case"hide":var o=r.hide;r.hide=function(){if(!r.isVisible){return}r.isVisible=false;if(r.cover){r.hideCover()}r.element.style.display="none";return o.apply(r,Array.prototype.slice.call(arguments))};break;default:if(r[i]instanceof Function){r[i]=jfork.bind(r[i],r)}}}return r}}();jfork.widget=function(e){}