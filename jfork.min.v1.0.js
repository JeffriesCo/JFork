/*!
 * jfork JavaScript Framework v1.0
 * http://jfork.com/
 *
 * Copyright 2012 The Jeffries Company and other contributors
 * Released under the MIT license
 * https://github.com/JeffriesCo/JFork/blob/master/LICENSE
 */

(function(window,undefined){var is={Number:function(a){return(a||a==0)&&!isNaN(a)&&a.constructor==Number?true:false},Function:function(a){return a instanceof Function?true:false},NodeList:function(a){return a&&is["Number"](a.length)&&is["Function"](a.item)?true:false},Date:function(a){return a instanceof Date?true:false},Element:function(a){return a&&("undefined"!==typeof a.childNodes||a.nodeType)?true:false},Array:function(a){return a&&a.constructor==Array?true:false},Object:function(a){return a&&typeof a=="object"&&!is["Array"](a)&&!is["Element"](a)&&!is["Date"](a)&&!is["NodeList"](a)?true:false},String:function(a){return typeof a=="string"?true:false},Boolean:function(a){return typeof a=="boolean"?true:false},Null:function(a){return a===null?true:false},RegExp:function(a){return a instanceof RegExp?true:false},Undefined:function(a){return a===undefined?true:false},Integer:function(a){return is["Number"](a)&&(a+"").indexOf(".")==-1?true:false},Variant:function(a){return true}};var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");while(c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0]){}return b>4?b:a}();var addEvent=function(a,b,c){if(a.attachEvent){a["e"+b+c]=c;a[b+c]=function(){a["e"+b+c](window.event)};a.attachEvent("on"+b,a[b+c])}else{a.addEventListener(b,c,false)}};var parseJSON=function(a){if(!jfork.isString(a)){return null}var b=/^[\],:{}\s]*$/;var c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var e=/(?:^|:|,)(?:\s*\[)+/g;a=a.replace(/^\s+|\s+$/g,"");if(window.JSON&&window.JSON.parse){return window.JSON.parse(a)}else if(b.test(a.replace(c,"@").replace(d,"]").replace(e,""))){return(new Function("return "+a))()}else{throw new Error("Cannot Parse JSON String.")}};var listen=function(a,b,c,d){if(ie<8){if(!a.propertyChangeHandlers){a.propertyChangeHandlers={}}if(a.propertyChangeHandlers[b]){a.detachEvent("onpropertychange",a.propertyChangeHandlers[b])}var e=function(f){if(f.propertyName==b){a.detachEvent("onpropertychange",e);d(a[b]);a[b]=c;a[b].toString=c;a.attachEvent("onpropertychange",e)}};a[b]=c;a[b].toString=c;a.attachEvent("onpropertychange",e);a.propertyChangeHandlers[b]=e}else{Object.defineProperty(a,b,{get:c,set:d,configurable:true})}};var looper=function(a,b){if(is.Array(a)){for(var c=0;c<a.length;c++){b(c,a[c],a)}}else{for(var d in a){b(d,a[d],a)}}};var clone=function(a){var b={};for(var c in a){if(is.Object(a[c])){b[c]=clone(a[c])}else{b[c]=a[c]}}return b};var bind=function(a,b){return function(){return a.apply(b,Array.prototype.slice.call(arguments))}};var getKeys=function(a){var b=[];for(var c in a){b.push(c)}return b};var Classes=[];var Class=function(a){var b,c,d={dynamic:{"public":{methods:{},variables:{}},"private":{methods:{},variables:{}}},"static":{"public":{methods:{},variables:{}},"private":{methods:{},variables:{}}}};var e=null;if(a.extend){for(var f=0;f<Classes.length;f++){if(a.extend===Classes[f].Class){e=Classes[f];d.dynamic=clone(e.signature.dynamic)}}if(e==null){throw new Error("Class to extend was not found.")}c=a.construct||e.construct}else{c=a.construct||function(){}}delete a.construct;delete a.extend;for(var g in a){var h=g.replace("private","").replace("public","").replace("static","").replace(/^\s+|\s+$/g,"");d[g.indexOf("static")!=-1?"static":"dynamic"][g.indexOf("private")!=-1?"private":"public"][a[g]instanceof Function?"methods":"variables"][h]=a[g]}var i=function(){if(ie<8){var a=document.createElement("class");document.body.appendChild(a);return a}else if(ie<9){var a=document.createElement("class");return a}else{return{}}};var j=function(a,b){for(var c in b.public.methods){a.public.methods[c]=b.public.methods[c]}for(var c in b.public.variables){a.public.variables[c]=b.public.variables[c]}for(var c in b.private.methods){a.private.methods[c]=b.private.methods[c]}for(var c in b.public.variables){a.private.variables[c]=b.private.variables[c]}return a};var k=function(a,b,c){c=c||b;looper(a,function(a,d,e){if(is.Function(d)){c[a]=bind(d,b)}else{listen(c,a,function(){return e[a]},function(b){e[a]=b})}})};var l=i();looper(d.static.public.variables,function(a,c){listen(l,a,function(){return b[a]},function(c){b[a]=c})});k(d.static.public.methods,l);k(d.static.private.variables,l);k(d.static.private.methods,l);b=function(){if(!(this instanceof b)){return null}var a=null,f=null,g=i(),h=clone(d.dynamic),j=arguments;if(e){function m(){return e.Class.apply(this,j)}m.prototype=e.Class.prototype;a=new m;f=e.instances[e.instances.length-1].privateDynamicContext;listen(f,"parent",ie<8?a:function(){return a},function(a){throw new Error("You cannot set super.")})}else{f=i()}looper(d.static.public.variables,function(a,c){listen(f,a,function(){return b[a]},function(c){b[a]=c})});k(d.static.public.methods,f);k(d.static.private.variables,f);k(d.static.private.methods,f);k(h.public.variables,f);k(h.public.methods,f);k(h.private.variables,f);k(h.private.methods,f);looper(d.static.public.variables,function(a,c){listen(g,a,function(){return b[a]},function(c){b[a]=c})});k(d.static.public.methods,l,g);k(h.public.variables,f,g);k(h.public.methods,f,g);g.dynamicSignature=h;g.signature=d;g.privateDynamicContext=f;for(var n=0;n<Classes.length;n++){if(b===Classes[n].Class){Classes[n].instances.push({instance:g,privateDynamicContext:f,dynamicSignature:h});break}}c.apply(f,j);return g};looper(d.static.public.variables,function(a,c){b[a]=c});k(d.static.public.methods,l,b);Classes.push({signature:d,construct:c,Class:b,privateStaticContext:l,instances:[]});return b};var jfork=Class;jfork.Class=Class;jfork.is=function(a){for(var b in is){if(is[b](a)){return b}}return null};for(var i in is){jfork.is[i]=is[i];jfork["is"+i]=is[i]}jfork.datatype=function(a){};jfork.Panel=jfork.Class({elem:null,isOpen:false,displayType:"block",events:{init:function(){},open:function(){},close:function(){}},construct:function(a,b){if(!jfork.isElement(a)){throw new Error("Element is required.")}this.elem=a;this.events={init:function(){},open:function(){},close:function(){},onCoverClick:function(){}};for(var c in this.events){if(b[c]&&this.events[c]){this.events[c]=b[c]}}if(b.isOpen){this.isOpen=true}},initialize:function(){this.events.init.apply(this,arguments);if(this.isOpen){this.open()}},open:function(){this.elem.style.display=this.displayType;this.isOpen=true;this.events.open.apply(this,arguments)},close:function(){this.elem.style.display="none";this.isOpen=false;this.events.close.apply(this,arguments)}});jfork.Dialog=jfork.Class({extend:jfork.Panel,"static zIndex":1001,cover:null,events:{init:function(){},open:function(){},close:function(){},onCoverClick:function(){}},open:function(){var a=this;if(this.cover==null){this.cover=document.createElement("div");this.cover.id=this.elem.id+"_cover";this.cover.className="jfork_Dialog_cover";this.cover.style.position="fixed";this.cover.style.top="0px";this.cover.style.left="0px";this.cover.style.width="100%";this.cover.style.height="100%";this.cover.style.display="none";document.body.appendChild(this.cover);addEvent(this.cover,"click",function(){a.events.onCoverClick.apply(a,[])})}this.cover.style.zIndex=this.zIndex;this.cover.style.display="block";this.parent.open.apply(this.parent,arguments);this.zIndex=this.zIndex+1;this.elem.style.zIndex=this.zIndex;this.elem.style.top=Math.floor((window.innerHeight-this.elem.offsetHeight)/2)+"px";this.elem.style.left=Math.floor((window.innerWidth-this.elem.offsetWidth)/2)+"px"},close:function(){this.cover.style.display="none";this.parent.close()}});jfork.PanelFactory=jfork.Class({storage:{},"private isPageLoaded":false,construct:function(){this.storage={}},initialize:function(){this.isPageLoaded=true;for(var a in this.storage){this.storage[a].instance=this.create(a,this.storage[a].args);this.storage[a].instance.initialize()}},toggle:function(a){if(this.storage[a]){if(this.storage[a].instance.isOpen){this.close(a)}else{this.open(a)}}},open:function(a,b){if(this.storage[a]){for(var c in this.storage){if(this.storage[c].group&&c!=a&&this.storage[c].group==this.storage[a].group){this.storage[c].instance.close()}}this.storage[a].instance.open.apply(this.storage[a].instance,b)}},close:function(a){if(this.storage[a]){this.storage[a].instance.close()}},get:function(a){if(this.storage[a]){return this.storage[a].instance}},add:function(a,b){var c=b.group||false;delete b.group;this.storage[a]={args:b,group:c};if(this.isPageLoaded){this.storage[a].instance=this.create(a,b)}},"private create":function(a,b){b=b||{};return new jfork.Panel(document.getElementById(a),b)}});jfork.DialogFactory=jfork.Class({extend:jfork.PanelFactory,"private create":function(a,b){b=b||{};return new jfork.Dialog(document.getElementById(a),b)}});jfork.AJAX=jfork.Class({"public static send":function(a){if(!a.url){return false}var b=a.method||"GET";var c=this.getRequest();c.abort();c.onreadystatechange=function(){if(c.readyState==4){if(c.status==200){if(a.onComplete){a.onComplete(c.responseText,c)}}else{if(a.onFail){a.onFail(c.responseText,c)}}}};var d=this.buildArgs(a.data||{});if(b=="POST"){c.open("POST",a.url,true);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.send(d)}else{if(a.url.indexOf("?")==-1){a.url+="?"}if(a.url.indexOf("=")!=-1){a.url+="&"}c.open("GET",a.url+d,true);c.send("")}},"private static getRequest":function(){var a=false;if(window.XMLHttpRequest&&!window.ActiveXObject){try{a=new XMLHttpRequest}catch(b){a=null}}else if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=null}}}return a},"private static buildArgs":function(a){var b="";for(var c in a){if(is.Array(a[c])){for(var d=0;d<a[c].length;d++){if(b.indexOf("=")!=-1){b+="&"}b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c][d])}}else{if(b.indexOf("=")!=-1){b+="&"}b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])}}return b}});jfork.API=jfork.Class({"private apiCalls":{},construct:function(a){this.apiCalls=a},send:function(a,b){b=b||{};var c=this.getPath(a,b.params);if(!c){return}b.data=b.data||{};b.method=b.method=="POST"?"POST":"GET";b.onSuccess=b.onSuccess||function(){};b.onFail=b.onFail||function(){};b.onComplete=b.onComplete||function(){};jfork.AJAX.send({url:c,method:b.method,data:b.data,onComplete:function(a){var c=parseJSON(a);if(c){if(c.success){b.onSuccess(c,b)}else{if(c.validationErrors&&c.validationErrors.length>0){c.message=c.validationErrors[0]}b.onFail(c,b)}}else{b.onFail({message:"Unable to parse JSON."},b)}b.onComplete(c,b)},onFail:function(a){b.onFail({message:a},b)}})},"private getPath":function(a,b){if(this.apiCalls[a]){var c=this.apiCalls[a];b=b||{};for(var d in b){c=c.replace("{"+d+"}",b[d])}if(c.indexOf("{")>-1||c.indexOf("}")>-1){return false}return c}else{return false}}});jfork.notification=new jfork.Class({"private onSet":null,"private onOpen":null,"private onClose":null,"private queue":null,"private elem":null,"private timeout":null,"private isOpen":false,"private delay":1e3,construct:function(a,b){b=b||{};this.queue=[];this.elem=a;this.delay=b.delay||1e3;this.onSet=b.set||false;this.onOpen=b.open||false;this.onClose=b.close||false},"private open":function(){if(this.isOpen){return}this.isOpen=true;if(this.onOpen){this.onOpen.apply(this,[this.elem])}else{this.elem.style.display="block"}},"private close":function(){if(!this.isOpen){return}this.isOpen=false;if(this.onClose){this.onClose.apply(this,[this.elem])}else{this.elem.style.display="none"}},"private set":function(a){if(this.onSet){this.onSet.apply(this,[this.elem,a])}else{this.elem.innerHTML=a}},"private next":function(){var a=this;this.timeout=null;if(this.queue.length>0){this.set(this.queue.pop());this.open();this.timeout=setTimeout(this.next,this.delay)}else{this.close()}},notify:function(a){this.queue.push(a);if(!this.timeout){this.next()}},clear:function(){this.close();clearTimeout(this.timeout)}});jfork.storage=new jfork.Class({"private primaryKey":null,"public static isAvailable":function(){try{if("localStorage"in window&&window["localStorage"]!==null){return true}}catch(a){return false}}(),construct:function(a){this.primaryKey=a},"public set":function(a,b){if(!this.isAvailable){return}var c=this.primaryKey+":"+a;if(jfork.isObject(b)){var d=function(a){var b=typeof a;if(b!="object"||a===null){a=String(a).replace(/"/g,"");if(b=="string"){a='"'+a+'"'}return a}else{var c,e,f=[],g=a&&a.constructor==Array;for(c in a){e=a[c];b=typeof e;if(b=="string")e='"'+e.replace(/"/g,"")+'"';else if(b=="object"&&e!==null)e=d(e);f.push((g?"":'"'+c+'":')+String(e))}return(g?"[":"{")+String(f)+(g?"]":"}")}};b=d(b)+":isObject"}window.localStorage.setItem(c,b);var e=window.localStorage.getItem(this.primaryKey+":allKeys")||"";e=e.split(",");for(var f=0;f<e.length;f++){if(e[f]==a){e.splice(f,1);break}}e.push(a);window.localStorage.setItem(this.primaryKey+":allKeys",e.join(","))},"public get":function(key){if(!this.isAvailable){return}var value=window.localStorage.getItem(this.primaryKey+":"+key);if(value){var valueSplit=value.split(":");if(valueSplit.pop()=="isObject"){value=eval("("+valueSplit.join(":")+")")}}return value},"public remove":function(a){if(!this.isAvailable){return}window.localStorage.removeItem(this.primaryKey+":"+a);var b=window.localStorage.getItem(this.primaryKey+":allKeys")||"";b=b.split(",");for(var c=0;c<b.length;c++){if(b[c]==a){b.splice(c,1);break}}window.localStorage.setItem(this.primaryKey+":allKeys",b.join(","))},"public getAll":function(){if(!this.isAvailable){return}var a=window.localStorage.getItem(this.primaryKey+":allKeys")||"";a=a.split(",");var b={};for(var c=0;c<a.length;c++){b[a[c]]=this.get(a[c])}return b},"public clear":function(){if(!this.isAvailable){return}var a=window.localStorage.getItem(this.primaryKey+":allKeys")||"";a=a.split(",");for(var b=0;b<a.length;b++){this.remove(a[b])}}});window.jfork=jfork})(window)